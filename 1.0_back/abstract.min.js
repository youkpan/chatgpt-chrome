if(typeof(selfphp)=="undefined"){var selfphp="abstract.php"}var urldir=url.replace(/(http|https):\/\/(.*)\/(.*)/g,"$1://$2/");var urldomain=url.replace(/(http|https):\/\/([^\/]+)(.*)/g,"$1://$2/");var _rootEl=document.compatMode=="CSS1Compat"?document.documentElement:document.body;function get_article(a){if(typeof(a)!="string"){var c="";for(var b=0;b<a.length;b++){c+=a[b].innerHTML+"\r\n"}}else{c=a}c=c.replace(/"/g,"“");c=c.replace(/<[ ]+/gi,"<");c=c.replace(/<br([\s\S]?)>/gi,"\r\n");c=c.replace(/<\!--[\s\S]*?-->/gi,"");c=c.replace(/<(\!(.*)?)>/gi,"");c=c.replace(/<(\/?link(.*)*?)>/gi,"");c=c.replace(/<(\/?form(.*)*?)>/gi,"");c=c.replace(/cookie/gi,"COOKIE");c=c.replace(/<(applet(.*)?)>([\s\S]*?)<(\/applet(.*)?)>/gi,"");c=c.replace(/<(\/?applet(.*)?)>/gi,"");c=c.replace(/<(style(.*)?)>([\s\S]*?)<(\/style(.*)?)>/gi,"");c=c.replace(/<(\/?style(.*)?)>/gi,"");c=c.replace(/<(object(.*)?)>([\s\S]*?)<(\/object(.*)?)>/gi,"");c=c.replace(/<(\/?objec(.*)?)>/gi,"");c=c.replace(/<(noframes(.*)?)>([\s\S]*?)<(\/noframes(.*)?)>/gi,"");c=c.replace(/<(\/?noframes(.*)?)>/gi,"");c=c.replace(/<(i?frame(.*)?)>([\s\S]*?)<(\/gi?frame(.*)?)>/gi,"");c=c.replace(/<(\/?i?frame(.*)?)>/gi,"");c=c.replace(/<(script(.*)?)>([\s\S]*?)<(\/script(.*)?)>/gi,"");c=c.replace(/<(\/?script(.*)?)>/gi,"");c=c.replace(/<(style(.*)?)>([\s\S]*?)<(\/style(.*)?)>/gi,"");c=c.replace(/<(\/?style(.*)?)>/gi,"");c=c.replace(/&#/gi,"&＃");c=c.replace(/<([\s\S]*?)>/gi,"");c=c.replace(/(\n([ \t　])*)+/gi,"\n");c=c.replace(/([\s\S])\.[ ]([\s\S])/g,"$1.。 $2");c=c.replace(".\n",".。\r\n");return c}function utf8ByteLength(c){if(!c){return 0}var a=encodeURI(c);var b=a.match(/%/g);return b?(a.length-b.length*2):a.length}var html_Ps="";var changed_sentences=0;function tipsInPs(d){if(inited!=10){return}if(document.getElementById("xubox_layer1")||changed_sentences>=4){return}if(d){b=d}else{if(html_Ps!=""){b=html_Ps}else{try{doc=window.document;var b=doc.getElementsByTagName("p")}catch(l){return}}}var c=abstact_result0.content;if(!c){return}if(b.length==0){return}var k,g,h,a;for(j=0;typeof(c[j])!="undefined"&&changed_sentences<4;j++){if(c[j][0]=="FOUND!"){continue}for(var f=0;f<b.length;f++){a=b[f].innerHTML;b[f].innerHTML=b[f].innerHTML.replace(c[j][0],"<b style='font-size:1.1em'>"+c[j][0]+"</b>");if(a!=b[f].innerHTML){changed_sentences+=1;c[j][0]="FOUND!"}}}console.log("changed_sentences :"+changed_sentences);if(changed_sentences<4){for(j=0;typeof(c[j])!="undefined"&&changed_sentences<4;j++){if(c[j][0]=="FOUND!"){continue}for(var f=0;f<b.length;f++){a=b[f].innerHTML;g=c[j][0].substring(0,7);if(utf8ByteLength(g)<=14){g=c[j][0].substring(0,28)}h=c[j][0].substring(c[j][0].length-7);if(utf8ByteLength(h)<=14){h=c[j][0].substring(c[j][0].length-28)}k=a;k=k.replace(g,"<b style='font-size:1.1em'>"+g);k=k.replace(h,h+"</b>");if(k.indexOf(h+"</b>")!=-1){b[f].innerHTML=k}if(a!=b[f].innerHTML){changed_sentences+=1;c[j][0]="FOUND!"}}}}console.log("changed_sentences :"+changed_sentences);if(changed_sentences<4&&d==null){doc=window.document;var b=doc.getElementsByTagName("div");tipsInPs(b)}else{changed_sentences=4}changelinks()}function pocess_abstact(a){inited=10;console.log("pocess_abstact");var c;var b="";if(a.err!="0"){console.log("not get abstact_result!");return}abstact_result0=a;if(a.err!="0"){$("span").html("error:");return}a=a.content;text_out="";text_out1="";abstact_result_a=new Array();for(i=0;typeof(a[i])!="undefined";i++){abstact_result_a[i]=new Array();abstact_result_a[i][0]=a[i][0];abstact_result_a[i][1]=a[i][1];abstact_result_a[i][2]=a[i][2]}abstact_result_a.sort(function(d,e){return(d[2]-e[2])});for(i=0;typeof(abstact_result_a[i])!="undefined";i++){qute="。";if(abstact_result_a[i][0].substring(abstact_result_a[i][0].length-1)=="."){qute=""}text_out+="　　"+abstact_result_a[i][0].replace(/^([　]|[ ]|(&nbsp;))*/g,"")+qute+"<br><div style='height:0.6em;width:100%'></div>";text_out1+=abstact_result_a[i][0]}if(text_out1.length>100&&notips==false){if(_rootEl.clientWidth<1024){wwidth=_rootEl.clientWidth-20;wleft="10px";wwidth=wwidth+"px";wheight=parseInt((_rootEl.clientHeight)*0.9)+"px";wtop="5px"}else{wwidth="640";wleft=parseInt((_rootEl.clientWidth-wwidth)*0.5)+"px";wwidth=wwidth+"px";wheight=parseInt((_rootEl.clientHeight)*0.9)+"px";wtop="10px"}resetnotips="";if(typeof(re_summary)!="undefined"){resetnotips="localStorage.setItem('notips',0);"}text_out+="<br><label class=\"xcheckbox\" style=\"font-weight:100;cursor:pointer;color:gray;\" title=\"仅标注在文章中\"><script>function checktips(){if(localStorage['notips']%2==1){document.getElementById('xubox_layer1').remove();document.getElementById('xubox_shade1').remove();}}"+resetnotips+"setTimeout(checktips,10);function fliptips(){if(typeof(localStorage['notips'])=='undefined'||localStorage['notips']=='NaN')	localStorage.setItem('notips',0);localStorage.setItem('notips',parseInt(localStorage['notips'])+1);}<\/script><input class=\"flipnotice\" type=\"checkbox\" onclick=\"fliptips\"/>此网站不再显示摘要</label><a href=\"http://zy.hayoou.com/api/\" style=\"font-weight:100;color:gray;\">&nbsp;·&nbsp;返回首页 </a> ";if(!$.layer&&layer.msg){$.layer=layer.msg}$.layer({shade:[0.75,"#444"],area:[wwidth,wheight],offset:[wtop,wleft],closeBtn:[1,true],shadeClose:true,title:"哈友自动摘要 <a href='http://zy.hayoou.com'>zy.hayoou.com</a>：",dialog:{msg:"<div   style='word-break: break-word;margin:0 2% 1% 2%;overflow:auto;display:block;font-size:1.1em;font-family: 微软雅黑, Arial, sans-serif;'>"+text_out+"</div>",btns:1,type:-1,btn:["好的","乱码?"],yes:function(d){layer.close(d)},no:function(d){layer.close(d);location=location+"&gb=1"}}})}console.log("pocess_abstact end")}httpp="http://zy";if(url.indexOf("https://")!=-1){httpp="https://zys"}var apiurl=httpp+".hayoou.com/api/summary.php"+(isdebug?"?dbg="+isdebug:"");function start_summary(a){if(inited!=0&&url!=""){return}inited=1;console.log("start_summary () ");if(a!=null){if(typeof(a)=="string"&&a.indexOf("http://")==0){$.get(a,function(b){pocess_abstact(b)})}else{pocess_abstact(a)}return}$.post(apiurl,{content_url:url,compress_size:5,just_check:1},function(c,b){if(b=="success"&&c.err=="0"){pocess_abstact(c)}else{iframeReadyStateChange()}});doc=window.document;document.title=doc.title+" 哈友自动摘要 文章摘要 重点标注"}function start_summary2(){if(inited==2){return}console.log("start_summary2 () ");inited=2;var d;var b="";d=document;var c=d.getElementsByTagName("h1");c=get_article(c)+"\r\n";var a=d.getElementsByTagName("p");b=c+get_article(a);if(utf8ByteLength(b)<600||url.indexOf("http://business.sohu.com")!=-1){b=c;if(url.indexOf("http://business.sohu.com")==0){var a=new Array();a[0]=d.getElementById("contentText");b+=get_article(a)}else{b+=get_article(d.body.innerHTML)}if(utf8ByteLength(b)<100){inited=0;console.log("contents.length :"+b.length);return}}console.log("start_summary2 ()  prepare post ");html_Ps=a;$.post(apiurl,{contents:b,content_url:url,compress_size:5},function(e){pocess_abstact(e)})}function flipnotice(){notips=!notips;console.log("flipnotice ");alert("notips:"+notips);changelinks()}function loadjscssfile(a,b,e,d){console.log("append "+a);if(b=="js"){var c=document.createElement("script");c.setAttribute("type","text/javascript");c.setAttribute("src",a);if(e!=null){c.setAttribute("charset",e)}}else{if(b=="css"){var c=document.createElement("link");c.setAttribute("rel","stylesheet");c.setAttribute("type","text/css");c.setAttribute("href",a);if(e!=null){c.setAttribute("charset",e)}}}if(typeof(c)!="undefined"){d.getElementsByTagName("head")[0].appendChild(c)}}function changeNodeA(g){if(g==null){g=iframee}try{var k=window.document;var c,a;var l=k.getElementsByTagName("a");for(var d=0;d<l.length;d++){a=(l[d].href.indexOf(selfphp)==-1)?false:true;if(l[d].href&&l[d].href.indexOf("javascript:")==-1&&a==false){c=l[d].href;if(l[d].href.indexOf("http://zy.hayoou.com/api/")==0){c=urldir+l[d].href.replace(/http:\/\/zy.hayoou.com\/(api\/)?/g,"")}else{if(l[d].href.indexOf("http://zy.hayoou.com/")==0){c=urldomain+l[d].href.replace(/http:\/\/zy.hayoou.com\/(api\/)?/g,"")}}l[d].href=selfphp+"?url="+encodeURIComponent(c)+"&gb=&notips="+(notips?"1":"0")}else{if(a==true){l[d].href=l[d].href.replace(/notips=\d/g,"notips="+(notips?"1":"0"))}}}var f=k.getElementsByTagName("img");for(var d=0;d<f.length;d++){if(f[d].src){if(f[d].src.indexOf("http://zy.hayoou.com/api/")==0){f[d].src=urldir+f[d].src.replace(/http:\/\/zy.hayoou.com\/(api\/)?/g,"")}else{if(f[d].src.indexOf("http://zy.hayoou.com")==0){f[d].src=urldomain+f[d].src.replace(/http:\/\/zy.hayoou.com\/(api\/)?/g,"")}}}}var l=k.getElementsByTagName("link");for(var d=0;d<l.length;d++){if(l[d].href){if(l[d].href.indexOf("http://zy.hayoou.com/api/")==0){l[d].href=urldir+l[d].href.replace(/http:\/\/zy.hayoou.com\/(api\/)?/g,"");loadjscssfile(l[d].href,"css",l[d].charset,k)}else{if(l[d].href.indexOf("http://zy.hayoou.com")==0){l[d].href=urldomain+l[d].href.replace(/http:\/\/zy.hayoou.com\/(api\/)?/g,"");loadjscssfile(l[d].href,"css",l[d].charset,k)}}}}var b=k.getElementsByTagName("script");for(var d=0;d<b.length;d++){if(b[d].src){if(b[d].src.indexOf("http://zy.hayoou.com/api/")==0){b[d].src=urldir+b[d].src.replace(/http:\/\/zy.hayoou.com\/(api\/)?/g,"");loadjscssfile(b[d].src,"js",l[d].charset,k)}else{if(b[d].src.indexOf("http://zy.hayoou.com")==0){b[d].src=urldomain+b[d].src.replace(/http:\/\/zy.hayoou.com\/(api\/)?/g,"");loadjscssfile(b[d].src,"js",l[d].charset,k)}}}}}catch(h){return}}var clock_s=0;function changelinks(){return;changeNodeA(iframee);if(changed_sentences>0||clock_s>4){try{doc=window.document;var b=doc.getElementsByTagName("iframe");for(var a=0;a<b.length;a++){isself=(b[a].src.indexOf("http://zy.hayoou.com")==0)?true:false;if(b[a].src&&b[a].src.indexOf("javascript:")==-1&&isself==false){tmp=b[a].src;if(b[a].src.indexOf("http://zy.hayoou.com/api/")==0){tmp=urldir+b[a].src.replace(/http:\/\/zy.hayoou.com\/(api\/)?/g,"")}b[a].src="http://zy.hayoou.com/api/curl2.php?iframe=1&u="+encodeURIComponent(tmp);console.log("change iframe src  "+b[a].src)}changeNodeA(b[a])}}catch(c){}}}setInterval(start_summary,1500);setInterval(tipsInPs,2500);setInterval("clock_s+=1;",1000);iframe_src_old=location.href;function check_iframe_src(){try{idoc=window.document;iframe_href=idoc.location.href;if(iframe_src_old!=iframe_href){console.log("ifraee src changed!  ");if(iframe_href.indexOf("http://zy.hayoou.com/api/")!=0){}iframe_src_old=iframe_href}}catch(a){console.log(a)}}function locationchange(a,c){console.log("new location  "+a+"old location  "+c);try{iframe_href=a;if(iframe_src_old!=iframe_href){if(iframe_href.indexOf("http://zy.hayoou.com/api/")!=0){newlocation=selfphp+"?url="+iframe_href+"&gb=&notips="+(notips?"1":"0");console.log("change iframe location  "+newlocation);iframee.src=newlocation}iframe_src_old=iframe_href}}catch(b){console.log(b)}}function iframeReadyStateChange(a){idoc=window.document;state=idoc.readyState;console.log("iframeReadyStateChange: "+state);if((state=="xloaded"||state=="interactive"||state=="complete")){if(inited<10){if(inited==0){start_summary();setTimeout("iframeReadyStateChange(0)",2000)}if(inited==1){start_summary2()}}if(state=="interactive"||state=="complete"){changelinks()}}}$.ready(function(){console.log("body ready !!")});
